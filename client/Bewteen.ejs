<!DOCTYPE html>
<html lang="en">
  <head>
    <link
    rel="stylesheet"
    href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css"
  />
</head>
    <link
      rel="shortcut icon"
      type="image/x-icon"
      href="https://i.imgur.com/mvPmzAP.png"
    />
    <title>Battleship</title>
    <script type="text/javascript">
      window.history.forward();
      function noBack() {
        window.history.forward();
      }
    </script>
  </head>
  <style>
    #hide {
      display: block;
    }
    #show {
      display: none;
      
    }
  </style>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/2.0.4/socket.io.js"></script>

  <body id="background">
    <div id="hide">
      <%- include('partials/choseGame') %>
    </div>
    <div id="show">
      <%- include('partials/game') %>
    </div>
  </body>
  <script>
    $("#umvsum").click(Play1vs1);
    $("#tourn").click(PlayTournament);
    $("#logout").click(Logout);
    var socket;
    function Play1vs1() {
      // alert("Bora jogar!!");
      socket = io.connect();
      var username = localStorage.getItem("username");
      socket.emit("join", username);

      var id = this.id;
      var modal = document.getElementById("myModal");
      modal.style.display = "block";

      var span = document.getElementsByClassName("close")[0];

      span.onclick = function() {
        modal.style.display = "none";
        socket.emit("leaveWaiting", function() {
          console.log("Disconnected from server.");
        });
      };

      socket.on("changePage", function(data) {
        if (data.success == true) {
          $("#hide").css("display","none");
          $("#show").css("display","block");
          
          console.log("Starting game");
          onmeo();
        }
      });
    }
function onmeo(){

       
      socket.on("disconnect", function() {
        console.log("Disconnected from server.");    
        $("#game").hide();
      });
 
      
     /* socket.on("join", function(gameId) {
        Game.initGame();
        $("#messages").empty();
        $("#disconnected").hide();
        $("#waiting-room").hide();
        $("#game").show();
        $("#game-number").html(gameId);
      });*/

      
      socket.on("update", function(gameState) {
        Game.setTurn(gameState.turn);
        Game.updateGrid(gameState.gridIndex, gameState.grid);
      });

      
      socket.on("chat", function(msg) {
        $("#messages").append(
          "<li><strong>" + msg.name + ":</strong> " + msg.message + "</li>"
        );
        $("#messages-list").scrollTop($("#messages-list")[0].scrollHeight);
      });

      
      socket.on("notification", function(msg) {
        $("#messages").append("<li>" + msg.message + "</li>");
        $("#messages-list").scrollTop($("#messages-list")[0].scrollHeight);
      });

      
      socket.on("gameover", function(isWinner) {
        Game.setGameOver(isWinner);
      });
      
     socket.on("leave", function() {
        $("#game").hide();
        $("#waiting-room").show();
      });

      
      $("#message-form").submit(function() {
        socket.emit("chat", $("#message").val());
        $("#message").val("");
        return false;
      });
 


    var GameStatus = {
      inProgress: 1,
      gameOver: 2
    };
  }
  </script>
</html>
